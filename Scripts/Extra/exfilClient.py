#https://www.thepythoncode.com/article/send-receive-files-using-sockets-python
import socket
import tqdm
import os

SEPARATOR = "<sep>"
BUFFER_SIZE = 4096

#Get these two from terminal?
host = ""
filename = ""

port = 5003
#Gets the file size in bytes
filesize = os.path.getsize(filename)

#Create the client socket
s = socket.socket()

#Connect to server
print(f"Connecting to {host}:{port}")
s.connect((host,port))
print("[+] Connected.")

#Send file name and size
s.send(f"{filename}{SEPARATOR}{filesize}".encode())
progress = tqdm.tqdm(range(filesize),f"Sending {filename}", unit="B",unit_scale=True,unit_divisor=1024)
with open(filename, "rb") as f:
    while True:
        #Read bytes from the file
        bytesRead = f.read(BUFFER_SIZE)
        if not bytesRead:
            #File transmitting is done
            break
        #Use sendall to assure transmission in busy networks
        s.sendall(bytesRead)
        #Update the progress bar
        progress.update(len(bytesRead))

#Close the socket
s.close()